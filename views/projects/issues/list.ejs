<%- include('../../partials/_sidebar.ejs') %>

<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
  <div class="container-fluid">
    <div
      class="chartjs-size-monitor-expand"
      style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"
    >
      <div
        style="position:absolute;width:1000000px;height:1000000px;left:0;top:0"
      ></div>
    </div>
    <div
      class="chartjs-size-monitor-shrink"
      style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"
    >
      <div style="position:absolute;width:200%;height:200%;left:0; top:0"></div>
    </div>
    <h1 class="display-4 mb-1"><%= title %></h1>
    <p class="h5 mb-4 text-secondary">#<%= result.projectid %> <%= result.name %></p>
    <div class="shadow-sm card">
      <div class="card-body">
        <form action="">
          <input type="hidden" id="page" name="page" value="1" />
          <h3 class="h3 mb-3">Filters</h3>
          <hr />
          <div class="form-group row">
            <div class="col-sm">
              <label for="filter-id" class="col-form-label">
                <input type="checkbox" id="filter-id" name="checkId" /> ID
              </label>
            </div>
            <div class="col-sm-11">
              <input
                type="text"
                class="form-control"
                name="inputId"
                placeholder="ID"
              />
            </div>
          </div>
          <div class="form-group row">
            <div class="col-sm">
              <label for="filter-subject" class="col-form-label">
                <input
                  type="checkbox"
                  id="filter-subject"
                  name="checkSubject"
                />
                Subject
              </label>
            </div>
            <div class="col-sm-11">
              <input
                type="text"
                class="form-control"
                name="inputSubject"
                placeholder="Subject"
              />
            </div>
          </div>
          <div class="form-group row">
            <div class="col-sm">
              <label for="filter-issue" class="col-form-label">
                <input type="checkbox" id="filter-issue" name="checkTracker" />
                Tracker
              </label>
            </div>
            <div class="col-sm-11">
              <select class="custom-select" name="inputTracker">
                <option selected>Choose issue tracker</option>
                <option value="Bug">Bug</option>
                <option value="Feature">Feature</option>
                <option value="Support">Support</option>
              </select>
            </div>
          </div>
          <button class="btn btn-sm btn-dark" type="submit">
            Search
          </button>
          <a href="/projects/issues/<%= result.projectid %>"></a>
            <button class="btn btn-sm btn-default" type="submit">
              Reset
            </button>

        </form>
      </div>
    </div>
    <div class="shadow-sm card mt-3">
      <div class="card-body">
        <form action="/projects/issues/<%= result.projectid %>" method="POST">
          <h3 class="h3 mb-3">Option</h3>
          <hr />
          <div class="form-group row">
            <div class="col-sm-1">Columns</div>
            <div class="col-sm-2">
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-id"
                  name="checkId"
                  value="true"
                  <%= option.checkId ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-id">
                  ID
                </label>
              </div>
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-tracker"
                  name="checkTracker"
                  value="true"
                  <%= option.checkTracker ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-tracker">
                  Tracker
                </label>
              </div>
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-subject"
                  name="checkSubject"
                  value="true"
                  <%= option.checkSubject ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-subject">
                  Subject
                </label>
              </div>
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-description"
                  name="checkDescription"
                  value="true"
                  <%= option.checkDescription ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-description">
                  Description
                </label>
              </div>
            </div>
            <div class="col-sm-2">
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-status"
                  name="checkStatus"
                  value="true"
                  <%= option.checkStatus ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-status">
                  Status
                </label>
              </div>
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-priority"
                  name="checkPriority"
                  value="true"
                  <%= option.checkPriority ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-priority">
                  Priority
                </label>
              </div>
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-asignee"
                  name="checkAssignee"
                  value="true"
                  <%= option.checkAssignee ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-asignee">
                  Assignee
                </label>
              </div>
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-start-date"
                  name="checkStartDate"
                  value="true"
                  <%= option.checkStartDate ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-start-date">
                  Start date
                </label>
              </div>
            </div>
            <div class="col-sm-2">
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-due-date"
                  name="checkDueDate"
                  value="true"
                  <%= option.checkDueDate ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-due-date">
                  Due date
                </label>
              </div>
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-estimated"
                  name="checkEstimatedTime"
                  value="true"
                  <%= option.checkEstimatedTime ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-estimated">
                  Estimated time
                </label>
              </div>
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-done"
                  name="checkDone"
                  value="true"
                  <%= option.checkDone ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-done">
                  Done
                </label>
              </div>
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-author"
                  name="checkAuthor"
                  value="true"
                  <%= option.checkAuthor ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-author">
                  Author
                </label>
              </div>
            </div>
            <div class="col-sm-2">
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-spent-time"
                  name="checkSpentTime"
                  value="true"
                  <%= option.checkSpentTime ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-spent-time">
                  Spent time
                </label>
              </div>
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-file"
                  name="checkFile"
                  value="true"
                  <%= option.checkFile ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-file">
                  File
                </label>
              </div>
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-target-version"
                  name="checkTargetVersion"
                  value="true"
                  <%= option.checkTargetVersion ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-target-version">
                  Target version
                </label>
              </div>
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-created-date"
                  name="checkCreatedDate"
                  value="true"
                  <%= option.checkCreatedDate ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-created-date">
                  Created date
                </label>
              </div>
            </div>
            <div class="col-sm-2">
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-updated-date"
                  name="checkUpdatedDate"
                  value="true"
                  <%= option.checkUpdatedDate ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-updated-date">
                  Updated date
                </label>
              </div>
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-closed-date"
                  name="checkClosedDate"
                  value="true"
                  <%= option.checkClosedDate ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-closed-date">
                  Closed date
                </label>
              </div>
              <div class="form-check mb-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="check-parent-task"
                  name="checkParentTask"
                  value="true"
                  <%= option.checkParentTask ? 'checked' : '' %>
                />
                <label class="form-check-label" for="check-parent-task">
                  Parent task
                </label>
              </div>
            </div>
          </div>
          <button class="btn btn-sm btn-dark" type="submit">
            Apply
          </button>
        </form>
        <div class="row mt-4">
          <div class="col-sm">
            <table class="table table-responsive">
              <thead class="thead-light">
                <tr>
                  <th scope="col-sm" <%= option.checkId ? '' : 'hidden' %>>ID</th>
                  <th scope="col-sm" <%= option.checkTracker ? '' : 'hidden' %>>Tracker</th>
                  <th scope="col-sm" <%= option.checkSubject ? '' : 'hidden' %>>Subject</th>
                  <th scope="col-sm" <%= option.checkDescription ? '' : 'hidden' %>>Description</th>
                  <th scope="col-sm" <%= option.checkStatus ? '' : 'hidden' %>>Status</th>
                  <th scope="col-sm" <%= option.checkPriority ? '' : 'hidden' %>>Priority</th>
                  <th scope="col-sm" <%= option.checkAssignee ? '' : 'hidden' %>>Assignee</th>
                  <th scope="col-sm" <%= option.checkStartDate ? '' : 'hidden' %>>Start date</th>
                  <th scope="col-sm" <%= option.checkDueDate ? '' : 'hidden' %>>Due date</th>
                  <th scope="col-sm" <%= option.checkEstimatedTime ? '' : 'hidden' %>>Estimated time</th>
                  <th scope="col-sm" <%= option.checkDone ? '' : 'hidden' %>>Done</th>
                  <th scope="col-sm" <%= option.checkAuthor ? '' : 'hidden' %>>Author</th>
                  <th scope="col-sm" <%= option.checkSpentTime ? '' : 'hidden' %>>Spent time</th>
                  <th scope="col-sm" <%= option.checkFile ? '' : 'hidden' %>>File</th>
                  <th scope="col-sm" <%= option.checkTargetVersion ? '' : 'hidden' %>>Target version</th>
                  <th scope="col-sm" <%= option.checkCreatedDate ? '' : 'hidden' %>>Created date</th>
                  <th scope="col-sm" <%= option.checkUpdatedDate ? '' : 'hidden' %>>Updated date</th>
                  <th scope="col-sm" <%= option.checkClosedDate ? '' : 'hidden' %>>Closed date</th>
                  <th scope="col-sm" <%= option.checkParentTask ? '' : 'hidden' %>>Parent task</th>
                  <th scope="col-sm">Action</th>
                </tr>
              </thead>
              <tbody>
                <% issuesResult.forEach((item) => { %>
                  <tr>
                    <th scope="row" <%= option.checkId ? '' : 'hidden' %>><%= item.issueid %></th>
                    <td <%= option.checkTracker ? '' : 'hidden' %>><%= item.tracker %></td>
                    <td <%= option.checkSubject ? '' : 'hidden' %>><%= item.subject %></td>
                    <td <%= option.checkDescription ? '' : 'hidden' %>><%= item.description %></td>
                    <td <%= option.checkStatus ? '' : 'hidden' %>><%= item.status %></td>
                    <td <%= option.checkPriority ? '' : 'hidden' %>><%= item.priority %></td>
                    <td <%= option.checkAssignee ? '' : 'hidden' %>><%= item.fullname %></td>
                    <td <%= option.checkStartDate ? '' : 'hidden' %>><%= item.startdate %></td>
                    <td <%= option.checkDueDate ? '' : 'hidden' %>><%= item.duedate %></td>
                    <td <%= option.checkEstimatedTime ? '' : 'hidden' %>><%= item.estimatedtime %> hours</td>
                    <td <%= option.checkDone ? '' : 'hidden' %>><%= item.done %>%</td>
                    <td <%= option.checkAuthor ? '' : 'hidden' %>><%= item.author %></td>
                    <td <%= option.checkSpentTime ? '' : 'hidden' %>><%= item.spenttime %></td>
                    <td <%= option.checkFile ? '' : 'hidden' %>><%= item.file %></td>
                    <td <%= option.checkTargetVersion ? '' : 'hidden' %>><%= item.targetversion %></td>
                    <td <%= option.checkCreatedDate ? '' : 'hidden' %>><%= item.createddate %></td>
                    <td <%= option.checkUpdatedDate ? '' : 'hidden' %>><%= moment(item.updateddate).format('LL') %></td>
                    <td <%= option.checkClosedDate ? '' : 'hidden' %>><%= item.closeddate %></td>
                    <td <%= option.checkParentTask ? '' : 'hidden' %>><%= item.issuename %></td>
                    <td>
                      <a href="/projects/issues/<%= result.projectid %>/edit/<%= item.issueid %>">
                        <button
                          type="button"
                          class="btn btn-sm btn-success btn-block mb-2"
                          type="submit"
                        >
                          Edit
                        </button>
                      </a>
                      <% if (user.isadmin) { %>
                        <a href="/projects/issues/<%= result.projectid %>/delete/<%= item.issueid %>">
                          <button
                            onclick="return confirm('Are you sure you want to delete this item?');"
                            type="button"
                            class="btn btn-sm btn-danger btn-block"
                            type="submit"
                          >
                            Delete
                          </button>
                        </a>
                      <% }; %>
                    </td>
                  </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
        </div>
        <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center">
            <li class="page-item <%= page <= 1 ? 'disabled' : '' %>">
              <a class="page-link" href="/projects<%= link.replace(`page=${parseInt(page)}`, `page=${parseInt(page) - 1}`) %>">Previous</a>
            </li>
            <% for (let i = 1; i <= pages; i++) { %>
              <li class="page-item <%= page == i ? 'active' : '' %>">
                <a class="page-link" href="/projects<%= link.replace(`page=${page}`, `page=${i}`) %>"><%= i %></a>
              </li>
            <% }; %>
            <li class="page-item <%= page >= pages ? 'disabled' : '' %>">
              <a class="page-link" href="/projects<%= link.replace(`page=${parseInt(page)}`, `page=${parseInt(page) + 1}`) %>">Next</a>
            </li>
          </ul>
        </nav>
        <a href="/projects/issues/<%= result.projectid %>/add">
          <button type="button" class="btn btn-sm btn-dark">Add data</button>
        </a>
      </div>
    </div>
  </div>
</main>
<%- include('../../partials/_footer.ejs') %>
